<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ToolifyX ‚Äì All-in-One Tools Hub</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
<style>
:root {
  --bg-light: #f8f9fa;
  --card-light: #ffffff;
  --accent: #4dabf7;
  --accent-2: #3b8beb;
  --muted: #6c757d;
  --danger: #f06595;
  --success: #37b24d;
  --shadow: rgba(0,0,0,0.08);

  --bg-dark: #121212;
  --card-dark: #1e1e1e;
  --muted-dark: #a0a0a0;
}

body { margin:0; font-family: 'Inter', sans-serif; background: var(--bg-light); color: #212529; transition:0.3s; }
body.dark { background: var(--bg-dark); color: #ffffff; }
header { padding:20px 25px; display:flex; justify-content:space-between; align-items:center; }
.logo { font-weight:700; font-size:1.5rem; color: var(--accent); }
body.dark .logo { color: var(--accent-2); }
.tag { font-size:0.9rem; color: var(--muted); }
body.dark .tag { color: var(--muted-dark); }
main { max-width: 1100px; margin: 20px auto; padding:0 20px; }
.grid { display:grid; grid-template-columns:1fr 2fr; gap:20px; }
@media(max-width:900px){ .grid{grid-template-columns:1fr;} }
.card { background: var(--card-light); border-radius:12px; padding:16px; box-shadow:0 4px 12px var(--shadow); transition:0.3s; }
body.dark .card { background: var(--card-dark); }
.tool-list { display:flex; flex-direction:column; gap:12px; }
.tool-btn { display:flex; align-items:center; gap:12px; padding:12px; border-radius:10px; cursor:pointer; border:1px solid rgba(0,0,0,0.05); transition:0.2s; }
.tool-btn:hover { box-shadow:0 8px 16px var(--shadow); transform: translateY(-2px); }
.tool-emoji { font-size:20px; }
.tool-title { font-weight:600; }
.tool-desc { font-size:0.85rem; color: var(--muted); }
body.dark .tool-desc { color: var(--muted-dark); }
.section { display:none; margin-bottom:20px; }
.section.visible { display:block; }
.controls { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
button { border:none; border-radius:8px; padding:8px 14px; cursor:pointer; font-weight:600; transition:0.2s; }
button.btn { background: linear-gradient(180deg, var(--accent), var(--accent-2)); color:#fff; }
button.ghost { background:transparent; border:1px solid rgba(0,0,0,0.1); color:var(--muted); }
body.dark button.ghost { color: var(--muted-dark); border-color: rgba(255,255,255,0.2); }
button.danger { background: var(--danger); color:#fff; }
input[type="file"], input[type="text"], textarea, select { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #dee2e6; background: #fff; color:#212529; transition:0.3s; }
body.dark input, body.dark select, body.dark textarea { background: #2a2a2a; color:#fff; border-color: #444; }
textarea { min-height:100px; resize:vertical; }
.result-area { margin-top:12px; padding:10px; border-radius:8px; background: #f1f3f5; border:1px dashed rgba(0,0,0,0.05); transition:0.3s; }
body.dark .result-area { background: #2a2a2a; border-color: rgba(255,255,255,0.2); }
.muted { color:var(--muted); }
body.dark .muted { color: var(--muted-dark); }
.row { display:flex; gap:10px; flex-wrap:wrap; }
footer { text-align:center; padding:12px 0; color:var(--muted); font-size:0.9rem; margin-top:30px; }
body.dark footer { color: var(--muted-dark); }

/* Theme toggle switch */
.switch { position:relative; display:inline-block; width:50px; height:24px; margin-left:10px; }
.switch input { opacity:0;width:0;height:0; }
.slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background:#ccc; transition:.4s; border-radius:24px; }
.slider:before { position:absolute; content:""; height:18px; width:18px; left:3px; bottom:3px; background:white; transition:.4s; border-radius:50%; }
input:checked + .slider { background: var(--accent-2); }
input:checked + .slider:before { transform: translateX(26px); }

/* Spinner */
.spinner {
  border:4px solid rgba(0,0,0,0.1);
  border-left-color: var(--accent-2);
  border-radius:50%;
  width:30px;
  height:30px;
  animation: spin 1s linear infinite;
  margin:auto;
}
@keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<header>
  <div class="logo">ToolifyX</div>
  <div style="display:flex;align-items:center;">
    <div class="tag">Light ‚Ä¢ Dim Mode</div>
    <label class="switch">
      <input type="checkbox" id="themeToggle">
      <span class="slider"></span>
    </label>
  </div>
</header>

<main>
  <div class="grid">
    <!-- Left Panel: Tool List -->
    <div class="left">
      <div class="card">
        <h3>Tools</h3>
        <p class="muted small">Click a tool to open its panel. Cancel/Reset is available in each tool.</p>
        <div class="tool-list" style="margin-top:12px">
          <div class="tool-btn" onclick="openTool('imageCompressor')"><div class="tool-emoji">üñºÔ∏è</div><div><div class="tool-title">Image Compressor</div><div class="tool-desc">Compress & download images</div></div></div>
          <div class="tool-btn" onclick="openTool('imageToPdf')"><div class="tool-emoji">üñ®Ô∏è</div><div><div class="tool-title">Image ‚Üí PDF</div><div class="tool-desc">Convert images to PDF</div></div></div>
          <div class="tool-btn" onclick="openTool('pdfMerger')"><div class="tool-emoji">üìÑ</div><div><div class="tool-title">PDF Merger</div><div class="tool-desc">Merge multiple PDFs</div></div></div>
          <div class="tool-btn" onclick="openTool('qrGenerator')"><div class="tool-emoji">üîó</div><div><div class="tool-title">QR Generator</div><div class="tool-desc">Generate QR codes</div></div></div>
          <div class="tool-btn" onclick="openTool('caseConverter')"><div class="tool-emoji">üî§</div><div><div class="tool-title">Text Case Converter</div><div class="tool-desc">Uppercase, lowercase, sentence</div></div></div>
          <div class="tool-btn" onclick="openTool('urlShortener')"><div class="tool-emoji">üîó</div><div><div class="tool-title">URL Shortener</div><div class="tool-desc">ShrinkMe helper & redirect</div></div></div>
          <div class="tool-btn" onclick="openTool('aiTextGenerator')"><div class="tool-emoji">ü§ñ</div><div><div class="tool-title">AI Text Generator</div><div class="tool-desc">Generate text using AI</div></div></div>
          <div class="tool-btn" onclick="openTool('aiImageGenerator')"><div class="tool-emoji">üñºÔ∏è</div><div><div class="tool-title">AI Image Generator</div><div class="tool-desc">Generate AI images from prompt</div></div></div>
        </div>
      </div>
    </div>

    <!-- Right Panel: Tool Sections -->
    <div class="right">
      <!-- IMAGE COMPRESSOR -->
      <div id="imageCompressor" class="card section">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>üñºÔ∏è Image Compressor</h3>
          <div>
            <button class="ghost" onclick="resetImageCompressor()">Clear</button>
            <button class="ghost" onclick="closeAll()">Close</button>
          </div>
        </div>
        <p class="muted small">Select image, choose quality/scale, then compress & download.</p>
        <input id="imgInput" type="file" accept="image/*">
        <div style="display:flex; gap:10px; margin-top:10px;">
          <select id="imgQuality"><option value="0.9">High 90%</option><option value="0.75" selected>Medium 75%</option><option value="0.6">Low 60%</option></select>
          <select id="imgScale"><option value="1">100%</option><option value="0.75">75%</option><option value="0.5">50%</option></select>
        </div>
        <div class="controls"><button class="btn" onclick="compressImage()">Compress</button><button class="ghost" onclick="resetImageCompressor()">Cancel / Reset</button></div>
        <div id="imgResult" class="result-area"></div>
        <canvas id="imgCanvas" style="display:none;"></canvas>
      </div>

      <!-- IMAGE ‚Üí PDF -->
      <div id="imageToPdf" class="card section">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>üñ®Ô∏è Image ‚Üí PDF</h3>
          <div>
            <button class="ghost" onclick="resetImageToPdf()">Clear</button>
            <button class="ghost" onclick="closeAll()">Close</button>
          </div>
        </div>
        <p class="muted small">Select multiple images to create a single PDF.</p>
        <input id="imagesToPdf" type="file" accept="image/*" multiple>
        <div class="row" style="margin-top:10px"><button class="btn" onclick="imagesToPdf()">Create PDF</button><button class="ghost" onclick="resetImageToPdf()">Cancel / Reset</button></div>
        <div id="img2pdfResult" class="result-area"></div>
      </div>

      <!-- PDF MERGER -->
      <div id="pdfMerger" class="card section">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>üìÑ PDF Merger</h3>
          <div>
            <button class="ghost" onclick="resetPdfMerger()">Clear</button>
            <button class="ghost" onclick="closeAll()">Close</button>
          </div>
        </div>
        <p class="muted small">Select multiple PDFs to merge into one.</p>
        <input id="pdfFiles" type="file" accept="application/pdf" multiple>
        <div class="row" style="margin-top:10px"><button class="btn" onclick="mergePDFs()">Merge PDFs</button><button class="ghost" onclick="resetPdfMerger()">Cancel / Reset</button></div>
        <div id="pdfResult" class="result-area"></div>
      </div>

      <!-- QR GENERATOR -->
      <div id="qrGenerator" class="card section">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>üîó QR Generator</h3>
          <div>
            <button class="ghost" onclick="resetQR()">Clear</button>
            <button class="ghost" onclick="closeAll()">Close</button>
          </div>
        </div>
        <input id="qrText" type="text" placeholder="Enter URL or text">
        <div class="row" style="margin-top:10px"><button class="btn" onclick="generateQR()">Generate QR</button><button class="ghost" onclick="resetQR()">Cancel / Reset</button></div>
        <div id="qrResult" class="result-area"></div>
      </div>

      <!-- TEXT CASE CONVERTER -->
      <div id="caseConverter" class="card section">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>üî§ Text Case Converter</h3>
          <div>
            <button class="ghost" onclick="resetCase()">Clear</button>
            <button class="ghost" onclick="closeAll()">Close</button>
          </div>
        </div>
        <textarea id="caseText" placeholder="Paste your text"></textarea>
        <div class="row" style="margin-top:10px"><button class="btn" onclick="convertCase('upper')">UPPERCASE</button><button class="btn" onclick="convertCase('lower')">lowercase</button><button class="btn" onclick="convertCase('sentence')">Sentence Case</button><button class="ghost" onclick="resetCase()">Cancel / Reset</button></div>
        <div id="caseResult" class="result-area"></div>
      </div>

      <!-- URL SHORTENER -->
      <div id="urlShortener" class="card section">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>üîó URL Shortener</h3>
          <div>
            <button class="ghost" onclick="resetShortener()">Clear</button>
            <button class="ghost" onclick="closeAll()">Close</button>
          </div>
        </div>
        <input id="longUrl" type="text" placeholder="Enter long URL">
        <div class="row" style="margin-top:10px"><button class="btn" onclick="shortenWithApi()">Shorten with API</button><button class="ghost" onclick="createRedirectHtml()">Create redirect page</button><button class="ghost" onclick="resetShortener()">Cancel / Reset</button></div>
        <div id="shortResult" class="result-area"></div>
      </div>

      <!-- AI TEXT GENERATOR -->
      <div id="aiTextGenerator" class="card section">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>ü§ñ AI Text Generator</h3>
          <div>
            <button class="ghost" onclick="resetAiText()">Clear</button>
            <button class="ghost" onclick="closeAll()">Close</button>
          </div>
        </div>
        <textarea id="aiTextPrompt" placeholder="Enter your prompt here..."></textarea>
        <div class="row" style="margin-top:10px"><button class="btn" onclick="generateAiText(event)">Generate Text</button><button class="ghost" onclick="resetAiText()">Cancel / Reset</button></div>
        <div id="aiTextResult" class="result-area"></div>
      </div>

      <!-- AI IMAGE GENERATOR -->
      <div id="aiImageGenerator" class="card section">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>üñºÔ∏è AI Image Generator</h3>
          <div>
            <button class="ghost" onclick="resetAiImage()">Clear</button>
            <button class="ghost" onclick="closeAll()">Close</button>
          </div>
        </div>
      <textarea id="aiImagePrompt" placeholder="Describe the image you want..."></textarea>

<div style="display:flex; gap:10px; margin-top:8px;">
  <input id="aiImageCount" type="number" min="1" max="5" placeholder="Number of images (1-5)" style="flex:1;">
  <select id="aiImageSize" style="flex:1;">
    <option value="256x256">256x256</option>
    <option value="512x512" selected>512x512</option>
    <option value="1024x1024">1024x1024</option>
  </select>
</div>

<div class="row" style="margin-top:10px">
  <button class="btn" onclick="generateAiImage(event)">Generate Image</button>
  <button class="ghost" onclick="resetAiImage()">Cancel / Reset</button>
</div>
<div id="aiImageResult" class="result-area"></div>
      </div>

    </div>
  </div>
</main>

<footer>
  ¬© <span id="year"></span> <strong>ToolifyX</strong> ‚Ä¢ Powered by <a href="https://aaoearn.netlify.app/" target="_blank">AAOEarn</a>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

const themeToggle = document.getElementById('themeToggle');
if(localStorage.getItem('theme')==='dark'){
  document.body.classList.add('dark');
  themeToggle.checked = true;
}
themeToggle.addEventListener('change', () => {
  if(themeToggle.checked){
    document.body.classList.add('dark');
    localStorage.setItem('theme','dark');
  } else {
    document.body.classList.remove('dark');
    localStorage.setItem('theme','light');
  }
});

// ---------------- OPEN/CLOSE TOOLS ----------------
function closeAll(){
  document.querySelectorAll('.section').forEach(s => s.classList.remove('visible'));
}

function openTool(id){
  closeAll();
  const section = document.getElementById(id);
  section.classList.add('visible');
  // Scroll down to the tool smoothly
  section.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// ---------------- IMAGE COMPRESSOR ----------------
function resetImageCompressor(){
  document.getElementById('imgInput').value='';
  document.getElementById('imgResult').innerHTML='';
}
function compressImage(){
  const file = document.getElementById('imgInput').files[0];
  if(!file){ alert('Select an image first'); return; }
  const quality = parseFloat(document.getElementById('imgQuality').value);
  const scale = parseFloat(document.getElementById('imgScale').value);
  const canvas = document.getElementById('imgCanvas');
  const ctx = canvas.getContext('2d');
  const img = new Image();
  img.onload = function(){
    canvas.width = img.width*scale;
    canvas.height = img.height*scale;
    ctx.drawImage(img,0,0,canvas.width,canvas.height);
    canvas.toBlob(blob=>{
      const url = URL.createObjectURL(blob);
      document.getElementById('imgResult').innerHTML = `<a href="${url}" download="compressed.png">Download Compressed Image</a>`;
    },'image/png',quality);
  };
  img.src = URL.createObjectURL(file);
}

// ---------------- IMAGE ‚Üí PDF ----------------
async function imagesToPdf(){
  const files = document.getElementById('imagesToPdf').files;
  if(!files.length){ alert('Select images'); return; }
  const pdfDoc = await PDFLib.PDFDocument.create();
  for(const f of files){
    const imgBytes = await f.arrayBuffer();
    let img;
    if(f.type.includes('png')) img = await pdfDoc.embedPng(imgBytes);
    else img = await pdfDoc.embedJpg(imgBytes);
    const page = pdfDoc.addPage([img.width,img.height]);
    page.drawImage(img,{x:0,y:0,width:img.width,height:img.height});
  }
  const pdfBytes = await pdfDoc.save();
  const blob = new Blob([pdfBytes],{type:'application/pdf'});
  const url = URL.createObjectURL(blob);
  document.getElementById('img2pdfResult').innerHTML=`<a href="${url}" download="images.pdf">Download PDF</a>`;
}
function resetImageToPdf(){
  document.getElementById('imagesToPdf').value='';
  document.getElementById('img2pdfResult').innerHTML='';
}

// ---------------- PDF MERGER ----------------
async function mergePDFs(){
  const files = document.getElementById('pdfFiles').files;
  if(!files.length){ alert('Select PDFs'); return; }
  const mergedPdf = await PDFLib.PDFDocument.create();
  for(const f of files){
    const bytes = await f.arrayBuffer();
    const pdf = await PDFLib.PDFDocument.load(bytes);
    const copied = await mergedPdf.copyPages(pdf,pdf.getPageIndices());
    copied.forEach(p=>mergedPdf.addPage(p));
  }
  const mergedBytes = await mergedPdf.save();
  const blob = new Blob([mergedBytes],{type:'application/pdf'});
  const url = URL.createObjectURL(blob);
  document.getElementById('pdfResult').innerHTML=`<a href="${url}" download="merged.pdf">Download Merged PDF</a>`;
}
function resetPdfMerger(){
  document.getElementById('pdfFiles').value='';
  document.getElementById('pdfResult').innerHTML='';
}

// ---------------- QR GENERATOR ----------------
function generateQR(){
  const text = document.getElementById('qrText').value.trim();
  if(!text){ alert('Enter text/URL'); return; }
  const container = document.getElementById('qrResult');
  container.innerHTML=''; // clear previous
  new QRCode(container,{text, width:180, height:180});
}
function resetQR(){
  document.getElementById('qrText').value='';
  document.getElementById('qrResult').innerHTML='';
}

// ---------------- TEXT CASE CONVERTER ----------------
function convertCase(type){
  const txt = document.getElementById('caseText').value;
  if(!txt){ alert('Enter text'); return; }
  let res;
  if(type==='upper') res = txt.toUpperCase();
  else if(type==='lower') res = txt.toLowerCase();
  else res = txt.replace(/(^\w|\.\s*\w)/g,c=>c.toUpperCase());
  document.getElementById('caseResult').textContent = res;
}
function resetCase(){
  document.getElementById('caseText').value='';
  document.getElementById('caseResult').innerHTML='';
}

// ---------------- URL SHORTENER ----------------
async function shortenWithApi(){
  const url = document.getElementById('longUrl').value.trim();
  if(!url){ alert('Enter URL'); return; }
  const result = document.getElementById('shortResult');
  result.innerHTML='<div class="spinner"></div>';
  try{
    const res = await fetch(`/.netlify/functions/shrinkme?url=${encodeURIComponent(url)}`);
    const data = await res.json();
    if(data.shortUrl) result.innerHTML=`<a href="${data.shortUrl}" target="_blank">${data.shortUrl}</a>`;
    else result.innerHTML='Error shortening URL';
  }catch(e){ result.innerHTML='Error connecting'; }
}
function createRedirectHtml(){
  const url = document.getElementById('longUrl').value.trim();
  if(!url){ alert('Enter URL'); return; }
  const content = `<meta http-equiv="refresh" content="0; url=${url}">`;
  const blob = new Blob([content],{type:'text/html'});
  const link = URL.createObjectURL(blob);
  document.getElementById('shortResult').innerHTML=`<a href="${link}" download="redirect.html">Download Redirect Page</a>`;
}
function resetShortener(){
  document.getElementById('longUrl').value='';
  document.getElementById('shortResult').innerHTML='';
}

// ---------------- AI TEXT GENERATOR ----------------
async function generateAiText(){
  const prompt = document.getElementById('aiTextPrompt').value.trim();
  if(!prompt){ alert('Enter prompt'); return; }
  const result = document.getElementById('aiTextResult');
  result.innerHTML='<div class="spinner"></div>';
  try{
    const res = await fetch(`/.netlify/functions/aiText`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({prompt})
    });
    const data = await res.json();
    if(data.text) result.textContent = data.text;
    else result.textContent = 'Error generating text';
  }catch(e){ result.textContent = 'Connection error'; }
}
function resetAiText(){
  document.getElementById('aiTextPrompt').value='';
  document.getElementById('aiTextResult').innerHTML='';
}

// ---------------- AI IMAGE GENERATOR ----------------
async function generateAiImage(){
  const prompt = document.getElementById('aiImagePrompt').value.trim();
  const n = document.getElementById('aiImageCount')?.value || 1;
  const size = document.getElementById('aiImageSize')?.value || '512x512';
  const result = document.getElementById('aiImageResult');
  result.innerHTML='<div class="spinner"></div>';

  if(!prompt){ alert('Enter prompt'); result.innerHTML=''; return; }

  try {
    const res = await fetch('/.netlify/functions/aiImage',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ prompt, n, size })
    });
    const data = await res.json();

    if(data.urls && data.urls.length){
      result.innerHTML = data.urls.map(url => `<img src="${url}" style="max-width:100%;margin-bottom:10px;border-radius:8px;">`).join('');
    } else {
      result.textContent = 'Error generating image';
    }
  } catch(e){
    result.textContent = 'Connection error';
    console.error(e);
  }
}
</script>

</body>
  </html>
